<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- Extension du formulaire hr.employee -->
        <record id="view_employee_form_ange_security" model="ir.ui.view">
            <field name="name">hr.employee.form.ange.security</field>
            <field name="model">hr.employee</field>
            <field name="inherit_id" ref="hr.view_employee_form"/>
            <field name="arch" type="xml">
                
                <!-- Ajout de l'onglet ÉQUIPEMENT ET SANTÉ -->
                <xpath expr="//notebook" position="inside">
                    <page string="ÉQUIPEMENT ET SANTÉ" name="equipment_health">
                        <group>
                            <group string="Équipement">
                                <div class="oe_button_box" name="button_box_equipements">
                                    <button name="action_view_equipements" type="object" class="oe_stat_button" icon="fa-wrench">
                                        <field name="nb_equipements_actifs" widget="statinfo" string="Actifs"/>
                                    </button>
                                    <button name="action_view_equipements" type="object" class="oe_stat_button" icon="fa-exclamation-triangle">
                                        <field name="nb_equipements_expires" widget="statinfo" string="Expirés"/>
                                    </button>
                                </div>
                                <field name="equipement_ids" context="{'default_employee_id': id}">
                                    <list string="Équipements" editable="bottom">
                                        <field name="equipement_id" required="1"/>
                                        <field name="date_remise"/>
                                        <field name="date_renouvellement" readonly="1"/>
                                        <field name="jours_avant_expiration" readonly="1" decoration-danger="jours_avant_expiration &lt; 0" decoration-warning="jours_avant_expiration &lt;= 30 and jours_avant_expiration &gt;= 0"/>
                                        <field name="statut" decoration-success="statut == 'actif'" decoration-warning="statut == 'expire'" decoration-muted="statut in ('renouvele', 'retire')"/>
                                        <button name="action_renouveler" string="Renouveler" type="object" class="btn-link" icon="fa-refresh" invisible="statut != 'actif'"/>
                                    </list>
                                </field>
                            </group>
                            <group string="Santé">
                                <field name="visite_medicale_ids" widget="one2many_list" colspan="2">
                                    <list string="Visites Médicales">
                                        <field name="date"/>
                                        <field name="description"/>
                                        <field name="fait" widget="boolean_toggle"/>
                                    </list>
                                </field>
                            </group>
                        </group>
                    </page>
                    <page string="FORMATIONS" name="formations_page">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="oe_button_box" name="button_box">
                                    <button name="action_view_formations" type="object" class="oe_stat_button" icon="fa-graduation-cap">
                                        <field name="nb_formations_total" widget="statinfo" string="Total"/>
                                    </button>
                                    <button name="action_view_formations" type="object" class="oe_stat_button" icon="fa-check-circle" style="color: #28a745;">
                                        <field name="nb_formations_terminees" widget="statinfo" string="Terminées"/>
                                    </button>
                                    <button name="action_view_formations" type="object" class="oe_stat_button" icon="fa-clock-o" style="color: #007bff;">
                                        <field name="nb_formations_en_cours" widget="statinfo" string="En cours"/>
                                    </button>
                                    <button name="action_view_formations" type="object" class="oe_stat_button" icon="fa-refresh" style="color: #dc3545;">
                                        <field name="nb_formations_recyclage" widget="statinfo" string="Recyclage"/>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <group>
                            <group string="Statistiques">
                                <field name="nb_formations_total" readonly="1"/>
                                <field name="nb_formations_terminees" readonly="1"/>
                                <field name="nb_formations_en_cours" readonly="1"/>
                                <field name="nb_formations_recyclage" readonly="1"/>
                            </group>
                        </group>
                        <field name="formation_ids" widget="one2many_list" nolabel="1">
                            <list decoration-success="statut=='terminee'" 
                                  decoration-warning="statut=='en_cours'" decoration-danger="statut=='recyclage_requis'"
                                  decoration-muted="statut=='non_fait'">
                                <field name="formation_id" options="{'no_create_edit': True}"/>
                                <field name="statut" widget="badge"/>
                                <field name="date_debut"/>
                                <field name="date_fin"/>
                                <field name="date_recyclage" readonly="1"/>
                                <field name="duree_formation" readonly="1" optional="hide"/>
                                <field name="jours_avant_recyclage" readonly="1" optional="hide"/>
                                <field name="alerte_recyclage" widget="boolean_toggle" readonly="1" optional="hide"/>
                            </list>
                        </field>
                    </page>
                </xpath>

                <!-- Modification de l'onglet INFORMATIONS PRIVÉES -->
                <!-- Renommage des champs d'identification -->
                <xpath expr="//field[@name='identification_id']" position="attributes">
                    <attribute name="string">Numéro CNI</attribute>
                </xpath>
                
                <xpath expr="//field[@name='passport_id']" position="attributes">
                    <attribute name="string">Numéro carte de séjour</attribute>
                </xpath>

                <!-- Ajout des dates de validité après les champs d'identification -->
                <xpath expr="//field[@name='identification_id']" position="after">
                    <field name="date_validite_cni"/>
                </xpath>
                
                <xpath expr="//field[@name='passport_id']" position="after">
                    <field name="date_validite_carte_sejour"/>
                </xpath>

                <!-- Ajout du matricule agent sous les coordonnées privées -->
                <xpath expr="//group[@name='emergency']" position="after">
                    <group string="Informations Agent">
                        <field name="matricule_agent" placeholder="Matricule unique de l'agent"/>
                    </group>
                </xpath>

                <!-- Ajout des champs faction dans la zone Horaire -->
                <xpath expr="//group[@name='departure']" position="after">
                    <group string="Faction">
                        <field name="type_faction_choisi" widget="radio"/>
                        <field name="faction_id" 
                               options="{'no_create_edit': True}"
                               domain="[('type_faction', '=', type_faction_choisi)]"
                               invisible="type_faction_choisi == False"/>
                    </group>
                </xpath>

            </field>
        </record>

        <!-- Vue liste étendue pour afficher le matricule agent -->
        <record id="view_employee_tree_ange_security" model="ir.ui.view">
            <field name="name">hr.employee.tree.ange.security</field>
            <field name="model">hr.employee</field>
            <field name="inherit_id" ref="hr.view_employee_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='work_phone']" position="after">
                    <field name="matricule_agent" optional="hide"/>
                </xpath>
            </field>
        </record>


        <!-- Vue de recherche étendue -->
        <record id="view_employee_filter_ange_security" model="ir.ui.view">
            <field name="name">hr.employee.search.ange.security</field>
            <field name="model">hr.employee</field>
            <field name="inherit_id" ref="hr.view_employee_filter"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='name']" position="after">
                    <field name="matricule_agent"/>
                </xpath>
                <xpath expr="//group" position="inside">
                    <filter string="Avec matricule agent" name="has_matricule" 
                            domain="[('matricule_agent', '!=', False)]"/>
                    <filter string="Équipements expirés" name="expired_equipment" 
                            domain="[('equipement_ids.statut', '=', 'expire')]"/>
                </xpath>
            </field>
        </record>

    </data>
</odoo>
